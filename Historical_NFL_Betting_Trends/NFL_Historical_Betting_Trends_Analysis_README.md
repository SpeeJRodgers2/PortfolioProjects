# NFL Betting-Line Database to Test Betting Strategies
#### Video Demo:     https://youtu.be/0L4o-wrXLIs
#### Description:     The goal of this project was to test the effectiveness of "winning" NFL betting strategies that I've heard about using historical data. Now, let's get into it!

First, I downloaded the data from Kaggle as .csv files. There were three tables of data: NFL teams; NFL stadiums; and NFL spreads. The data in each table was tracked from 1966 on. The NFL teams table has every team name along with what division/conference they were in. The NFL stadiums table has all the information about each stadium that's been used in the NFL. Lastly, the NFL spreads table has the most important data, the betting lines and results of every NFL game. However the regular season lines were not kept track of until the 1979 season, so that is the season where my main data analysis starts for betting strategies.

Before I could do any data analysis on betting strategies, I had to do a lot of work on cleaning the data. I used ".import --csv /filepath" to import the Kaggle datasets that I used into a sqlite database called NFL.db. This imported everything from the .csv file as datatype TEXT, so I needed to go through and change certain column's datatypes to be able to work with them properly in Python. I couldn't do this before making the spreads table a little more specific by breaking it into two tables: NFL_reg_season_spreads (for the regular season games) and NFL_post_season_spreads (for the post season or playoff games). I did this by making the post season table from scratch using CREATE TABLE and naming each column and datatype. Then, I used INSERT INTO to take all the rows of data (using *) WHERE week_number (changed to playoff_round in post season table) was equal to "Superbowl", "Conference", "Division", or "Wildcard". This WHERE statement covered all the post season games because the regular season week numbers were actual numbers or integers. Now I can change the datatypes of certain columns by using the ALTER TABLE statement in sqlite. First, I added a new column of datatype INT. Next, I filled the new column with data from the old column (which was still datatype TEXT) using the UPDATE statement and SET the new column equal to the old column but CAST AS datatype INT before using ALTER TABLE and DROP COLUMN to delete the old column. I also used the same process for any datatype that needed to be a float like the spread or over under total. Lastly, I got rid of all the data that did not have a spread value by using DELETE and WHERE, where the spread was equal to "NULL". I can't analyze betting strategies if there's no spread to judge them off of after all. (In hindsight this data could be usefyl to do machine-learning on but I already got WAY to ahead of myself on this project as it is!)

Now, I made new columns of data that I needed to fill with the help of Python, so I would be able to effectively analyze the spread tables easier. All the code I used to fill the tables with new data are located in the used_to_fill.py file. First, I used a sqlite command in python to pull the home team name, away team name, and the team_id of the team favorited to win from each game (or row) of the spreads table. These were all then put into a function I made in the critical_functions.py file called det_fav_home_away() to determine which team was favorited, the home team or the away team. This was then stored into a column in each table to be used later. Next, I made columns for wins, losses, and ties (or pushes) straight up, against the spread, and for the over under. These columns were filled using functions I made in the critical_functions.py file (the det_team_record_su(), det_team_record_as(), and det_over_under_record()) where every team name from the NFL teams table was input into the function by looping through the table in python using sqlite. It's a lot to go into on how I made those functions and this is already getting very long with more to go. Feel free to check out the funtions and see what you think! Lastly, I had looped through the playoff table seperately because it only needed the data from and including last week of the season. This means that I had to pull all the data from the final game of each regular season game for each team that made the post season and add onto it the results of that final game to the records. This is where putting more columns specific to each home and away teams results alongwith the over under result came in handy. The records only went up to the last game because they can't take into account the result of that weeks game since it didn't finish yet (you only can observe and try to predict the outcome of the teams record at the time the game started). By using the result of each game added onto the record of the final week from the proper season, the columns were updated for every team and every playoff game. Then I had to loop through the games again to do the reults columns for each playoff game. I couldn't use the regular season functions because they were based off of looping through every NFL team in the teams table and only a few teams make the playoffs. I figured the program would run faster if it just used the teams that participated and it did run much faster (also likely to do with MUCH fewer columns than the regular season table).

It is finally time to do some betting strategy analysis! Each betting strategy that I analyzed has it's own python file and outputs a chart using the numpy and matplotlib libraries in Python. Some of the function I used to fill the tables also came in handy during analysis! Shout out to the total_score() and game_over_under() functions I made! Before getting into betting strategies I just wanted to see if something you hear about all the time is true or not. Have rule changes and play style caused scoring to go up? The answer is a resounding yes! By looking at the overall_scoring_and_ou_over_time.py file you can see that scoring and the over under totals have steadily increased season over season very consistently.

![Have Over Under Lines Risen w Overall Scoring](https://github.com/code50/126349338/assets/126349338/fa9c74d4-60b0-4db2-b6ab-427c44b4392f)

While this graph makes one think "Wow, there's your betting strategy right there! Just take the over every time!" (the over is taking the total poins scored to be more than the over under total line set by the sportsbook). Not so fast! The under has actually hit almost 200 more time out of the almost 10,400 games played in our data set. You may also be thinking "Well, that is because scoring was lower. The over has to be hitting in recent years!". Well just last season the under hit 30 more times out of 268 games. Sportsbooks are very good atwhat they do. To have an edge in sportbetting you have to hit more than 52.4% of your bets. While that sounds easy, it is not! The reason you have to hit more than 52.4% of your bets on 50/50 bets is because sportsbooks take a "tax" for offering the betting action. If you bet 100$ on a 50/50 bet, the odds will be -110 and you will get 90.91$ on top of your 100$ back. If you lose they take the entire 100$. That means if you place two bets at -110 odds and you win one and lose the other you will be down about 9% of your money. This is why you have to hit at an above 50% ratio to be a profitbale bettor or for a strategy to be a profitbale one. That's why they're always building casinos and never tearing them down. With that information layed down, let's see if any betting strategy looks like it has historically yielded more than a 52.4% hit rate!

They say always bet on home underdogs! Let's see if that can be a winning strategy by looking at the how_often_home_dogs_bark.py file and it's chart.

![How Often Home Dogs Bark Per Season](https://github.com/code50/126349338/assets/126349338/8532f104-5f3e-4622-a52e-207ca2a605af)

Ok what if you bet over on the highest over under total each week or vice versa and bet the under on the lowest over under total each week. The second chart tell's us how many times these bets were a wash (say you hit one out of two bets or two out of four bets) and you lost the "juice" or the sportsbook's tax. Check the highest_overs_and_lowest_unders.py file and it's chart.

![Do the Highest Overs Go Over and Lowest Unders Go Under](https://github.com/code50/126349338/assets/126349338/f4cfd9f2-8662-4221-978e-c62b9b1b3e41)
![How Much Juice Was Lost On Washes](https://github.com/code50/126349338/assets/126349338/8464ee73-04b7-452c-b4d9-6570de2e54e4)

I've heard that historically the under hits more often early in the season! Let's also check to see if the over hits more often later in the year and if there is a trend growing through the middle of the season. Look at the early_unders_and_late_overs.py file and it's three charts.

![Do Unders Hit More Often Early in the Season](https://github.com/code50/126349338/assets/126349338/d83749f8-35bf-4291-903a-0ab684b147f5)
![Does the Over Hit Rate Shift in the Middle of the Season](https://github.com/code50/126349338/assets/126349338/d68773ef-b17f-4155-a36e-fdb535eea042)
![Do Overs Hit More Often Late in the Season](https://github.com/code50/126349338/assets/126349338/99189101-894d-4f49-9e39-b20af5591229)

Lastly, let's just see if a betting strategy can be devised by seeing how weather can affect overall scoring and the overs and unders in games impacted by inclement weather! Look at the many charts from the weather_related_over_unders.py file (please it was a lot of work).

![Percent of Overs in Games Inside or w Ideal Weather](https://github.com/code50/126349338/assets/126349338/7383e725-091f-4456-a16f-1d92591c0d01)
![Percent of Unders in Games w Hot Conditions](https://github.com/code50/126349338/assets/126349338/cadc51d7-68ff-447f-afcf-87a169325699)
![Percent of Unders in Games w Humid Conditions](https://github.com/code50/126349338/assets/126349338/97662a9d-6f4d-485a-83e6-24fc2aad885a)
![Percent of Unders in Games w Hot and Humid Conditions](https://github.com/code50/126349338/assets/126349338/ba80f383-8aeb-47f8-b471-7189292c5ed7)
![Percent of Unders in Games w Windy Conditions](https://github.com/code50/126349338/assets/126349338/1f5f2bb6-8364-4aa3-bd9c-289e613ccd8b)
![Percent of Unders in Games w Cold Conditions](https://github.com/code50/126349338/assets/126349338/4a977e6e-6566-4fec-a358-bd46701be9a2)
![Percent of Unders in Games w Precipitation](https://github.com/code50/126349338/assets/126349338/846065a6-d09a-43c0-a215-f968c01196d0)

Sadly, my project only yielded one profitbale strategy and that was to bet the under in games where the temperature was above 79 degrees and humidity was above 59 percent. That strategies chart shows the regression line comfortably above 52.4% for the entirety of the chart. There were other charts with decent regression lines, but they had skewed data in them. Any charts with points at 0 or 100 percent cannot be trusted because those points resulted from a small amount of data (they had one game fitting the parameters and either went 0 out of 1 or 1 out of 1). Besides that, all that I found out from this project was just how good sportsbooks are at setting their lines! It's actuall incredible! I do believe that there are more things to consider with more specific cases and by adding even more data and variables to look at in these tables! For example, how do teams that are favored by double digit points do throughout history depending on their number of wins compared to their opponents! I simply took WAy to long on this project already and need to get moving toward new data science classes so I needed to turn this in (I am very said I filled out all those columns for wins and losses straight up and against the spread without using them to analyze data *heavy sigh*). However, I hope anyone reading this enjoyed my little slice of research on this subject and the code that went into it! This class was amazing and I'm incredibly thankful that I got to take it and grow with it!